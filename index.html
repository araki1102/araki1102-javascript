<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>JavaScript練習</title>
<link href="favicon.ico" rel="shortcut icon">
<link href="https://fonts.googleapis.com/css?family=M+PLUS+1p:400,500" rel="stylesheet">
<link href="style.css" rel="stylesheet">
</head>
<body>
<header>
<div class="container">
<h1>楽天市場API</h1>
<h2></h2>
</div><!-- /.container -->
</header>
<main>
<div class="container">
<section>
    <form action="#" id="form">
        <input type="text" name="word">
        <select name="select">
            <option value="0">すべてのジャンル</option>
            <option value="551177">メンズファッション</option>
            <option value="100371">レディースファッション</option>
            <option value="558885">靴</option>
            <option value="216131">バッグ・小物・ブランド雑貨</option>
            <option value="216129">ジュエリー・アクセサリー</option>
            <option value="558929">腕時計</option>
            <option value="100433">インナー・下着・ナイトウェア</option>
            <option value="100533">キッズ・ベビー・マタニティ</option>
            <option value="100227">食品</option>
            <option value="551167">スイーツ・お菓子</option>
            <option value="100316">水・ソフトドリンク</option>
            <option value="100317">ワイン</option>
            <option value="510915">ビール・洋酒</option>
            <option value="510901">日本酒・焼酎</option>
            <option value="100026">パソコン・周辺機器</option>
            <option value="564500">スマートフォン・タブレット</option>
            <option value="211742">TV・オーディオ・カメラ</option>
            <option value="562637">家電</option>
            <option value="565004">光回線・モバイル通信</option>
            <option value="101240">CD・DVD</option>
            <option value="112493">楽器・音響機器</option>
            <option value="101070">スポーツ・アウトドア</option>
            <option value="101077">ゴルフ用品</option>
            <option value="100804">インテリア・寝具・収納</option>
            <option value="215783">日用品雑貨・文房具・手芸</option>
            <option value="558944">キッチン用品・食器・調理器具</option>
            <option value="100005">花・ガーデン・DIY</option>
            <option value="101213">ペット・ペットグッズ</option>
            <option value="100938">ダイエット・健康</option>
            <option value="551169">医薬品・コンタクト・介護</option>
            <option value="100939">美容・コスメ・香水</option>
            <option value="566382">おもちゃ</option>
            <option value="101205">テレビゲーム</option>
            <option value="200162">本・雑誌・コミック</option>
            <option value="101114">車・バイク</option>
            <option value="503190">車用品・バイク用品</option>
            <option value="101438">サービス・リフォーム</option>
            <option value="111427">住宅・不動産</option>
            <option value="101381">カタログギフト・チケット</option>
        </select>
        <input type="submit" value="検索">
    </form>
    <p id="output"></p>
    <ul id="rakutenItem"></ul>
</section>
</div><!-- /.container -->
</main>
<footer>
<div class="container">
<p>JavaScript Samples</p>
</div><!-- /.container -->
</footer>
<script src="../../_common/scripts/jquery-3.7.0.min.js"></script>
<script>
    'use strict';

    // 楽天リクエストURLから楽天市場の商品情報を取得
    //$rakutenUrl = "&sort=".$url_sort."&page=".$page.;

    document.getElementById('form').onsubmit = function(event) {
        event.preventDefault();
        const search = document.getElementById('form').word.value;
        const genre = document.getElementById('form').select.value;
        document.getElementById('output').textContent = `「${search}」の検索結果`;
        document.getElementById('form').select.onchange =function() {
        }
        //ファイルの読み込み
        $.ajax({
        url: 'https://app.rakuten.co.jp/services/api/IchibaItem/Search/20220601',
        type: 'GET',
        data: {
            'applicationId': '1050118187675753318',
            'formatVersion': 2,
            'genreId': genre,
            'keyword': search,
        }

        })
        .done(function(data) {
            console.log(data);
            let allItem = "";
            for (let i = 0; i < data.Items.length; i++) {
                const product = data.Items[i];
                let allItemParts =
                    `<li><a href="` +
                    product.itemUrl +
                    `" target="_blank" class="productLink link-` +
                    (i + 1) +
                    `">
                    <img src="` +
                    product.mediumImageUrls[0] +
                    `" alt="` +
                    product.itemName +
                    `" class="productImage">
                    <p class="productName">` +
                    product.itemName +
                    `</p>
                    <p class="productPrice">` +
                    product.itemPrice.toLocaleString() +
                    `<span>円</span></p>
                    </a></li>`;
                allItem += allItemParts;
            }
            document.getElementById("rakutenItem").innerHTML = allItem;
        })
        .fail(function() {
            window.alert('読み込みエラー');
        });

    };
</script>
</body>
</html>
